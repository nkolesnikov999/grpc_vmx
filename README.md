# gNMI Interface Monitor

Программа для мониторинга интерфейса ae1.0 на устройстве Juniper vMX через gNMI и сохранения данных в CSV файл.

## Требования

- Go 1.21 или выше
- Juniper vMX с настроенным gNMI сервисом
- Сетевое подключение к устройству

## Установка и запуск

1. Установите зависимости:
```bash
go mod tidy
```

2. Убедитесь, что на устройстве vMX настроен gNMI сервис согласно файлу `config.txt`

3. Запустите программу:
```bash
go run main.go
```

## Конфигурация

Программа использует следующие параметры по умолчанию:
- IP адрес устройства: `192.168.100.111:57400`
- Логин: `admin`
- Пароль: `admin@123`
- Интерфейс для мониторинга: `ae1.0`
- Выходной файл: `interface_data.csv`

## Выходные данные

Программа создает CSV файл `interface_data.csv` со следующими колонками:
- Timestamp - время получения данных
- Interface Name - имя интерфейса
- Operational Status - операционный статус
- Administrative Status - административный статус
- Input Octets - входящие байты
- Output Octets - исходящие байты
- Input Packets - входящие пакеты
- Output Packets - исходящие пакеты
- Speed (bps) - скорость интерфейса
- MTU - максимальный размер пакета

## Остановка программы

Для корректной остановки программы используйте Ctrl+C. Программа сохранит все данные в CSV файл перед завершением.

## Отладка

Для включения подробного логирования измените уровень в main.go:
```go
logrus.SetLevel(logrus.DebugLevel)
```

## Проверка успешности подписки

### Быстрая проверка
```bash
# Тест подключения и подписки
go run test_connection.go
```

### Автоматические проверки в программе
Основная программа автоматически проверяет:
- ✅ Доступность gNMI сервера
- ✅ Подтверждение подписки (SyncResponse)
- ✅ Получение данных обновлений
- ✅ Счетчик обновлений (каждые 10)

### Признаки успешной подписки
- Сообщение: "✅ Подписка успешно активирована!"
- Создание файла `interface_data.csv`
- Регулярные сообщения о получении обновлений
- Рост размера CSV файла

Подробнее см. [CHECK_SUBSCRIPTION.md](CHECK_SUBSCRIPTION.md)

## Проверка конфигурации vMX

Выполните следующие команды на устройстве vMX для проверки:

```bash
# Проверка статуса gNMI сервиса
show system services extension-service

# Проверка интерфейса
show interfaces ae1.0 extensive

# Проверка логов
show log messages | match grpc
```
